package ${target.javaPackageFromFolder(${TEST_SRC})};

import javax.annotation.Resource;

import org.junit.Assert;
import org.junit.Test;
import ${ENTITY_PKG}.${entity.name};
#if ( $entity.hasCompositePrimaryKey() )
import ${ENTITY_PKG}.${entity.name}Id;
#set( $keyType = "${entity.name}Id" )
#set( $keyName = "id" )
#set( $keyGetter = "getId" )
#set( $keySetter = "setId" )
#set( $keyInit = ${keyType}+" "+${keyName}+" = new "+${keyType}+"();" )
#else
#foreach( $field in $entity.keyAttributes )
#set( $keyType = "$field.formatedType(0)" )
#set( $keyName = "$field.formatedName(0)" )
#set( $keyGetter = "$field.getter" )
#set( $keySetter = "$field.setter" )
#if( $keyType == "String" )
	#set( $keyInit = ${keyType}+" "+${keyName}+" = ""1"";" )
#elseif( $keyType == "Integer" || $keyType == "Long" || $keyType == "Double" || $keyType == "Short" || $keyType == "BigDecimal" || $keyType == "BigInteger" )
	#set( $keyInit = ${keyType}+" "+${keyName}+" = "+${keyType}+".valueOf(""1"");" )
#else
	#set( $keyInit = ${keyType}+" "+${keyName}+" = new "+${keyType}+"();" )
#end
#end
#end

import ${ROOT_PKG}.test.common.AbstractRealDBTest;

public class ${entity.name}ServiceRealDBIntegTest extends AbstractRealDBTest {

	@Override
	protected String getDataFilename() {
		return null;
	}

	@Resource
	private ${entity.name}Service ${entity.name.toLowerCase()}Service;

	@Test
	public void cycle_vie_complet() {

		${keyInit}

		${entity.name} ${entity.name.toLowerCase()} = new ${entity.name}();
		${entity.name.toLowerCase()}.${keySetter}(${keyName});
		//${entity.name.toLowerCase()}.setName("Test " + ${keyName});

		// Create
		this.${entity.name.toLowerCase()}Service.save(${entity.name.toLowerCase()});

		// Search
		${entity.name.toLowerCase()} = this.${entity.name.toLowerCase()}Service.findById(${keyName});
		Assert.assertNotNull(${entity.name.toLowerCase()});

		// Update
		//${entity.name.toLowerCase()}.setName("Test 2 " + ${keyName});
		${entity.name.toLowerCase()} = this.${entity.name.toLowerCase()}Service.save(${entity.name.toLowerCase()});

		// Search
		${entity.name.toLowerCase()} = this.${entity.name.toLowerCase()}Service.findById(${keyName});
		//Assert.assertEquals("Test 2 " + ${keyName}, ${entity.name.toLowerCase()}.getName());

		// Delete
		this.${entity.name.toLowerCase()}Service.delete(${entity.name.toLowerCase()}.${keyGetter}());

		// Search
		${entity.name.toLowerCase()} = this.${entity.name.toLowerCase()}Service.findById(${keyName});
		Assert.assertNull(${entity.name.toLowerCase()});
	}

}
